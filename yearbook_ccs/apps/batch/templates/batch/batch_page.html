{% extends 'base.html' %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'css/batch_page.css' %}" />
<link rel="stylesheet" href="{% static 'css/profile_card.css' %}" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="{% static 'js/profile_card_script.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock extra_styles %}

{% block content %}
<div class="batch-cover container-fluid d-flex flex-column justify-content-center position-relative">
  <h2 class="text-center">
    {% if request.GET.program == 'BSCS' %}
      Bachelor of Computer Science
    {% elif request.GET.program == 'BSIT' %}
      Bachelor of Information Technology
      {% else %}
      {% if user_profile.program == 'BSCS' %}
        Bachelor of Computer Science
      {% else %}
        Bachelor of Information Technology
      {% endif %}
    {% endif %}
  </h2>
  <div class="orange-rectangle-design"></div>

  <!-- Search and Filter -->
  <div class="search-filter position-absolute top-0 end-0 m-3 d-flex align-items-center">
    <form method="GET" action="{% url 'search_profile' %}" class="me-2">
      <input type="text" class="form-control" name="search" placeholder="Search by Name" />
    </form>
    <form method="GET" action="{% url 'batch_page' %}" class="d-flex align-items-center">
      <div class="dropdown me-2">
        <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Filter</button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <select name="year" class="form-select">
              <option value="">Batch Year</option>
              {% for year in all_batch_years %}
              <option value="{{ year }}" {% if year == request.GET.year %}selected{% endif %}>{{ year }}</option>
              {% endfor %}
            </select>
          </li>
          <li>
            <select name="program" class="form-select">
              <option value="">Program</option>
              {% for program in available_programs %}
              <option value="{{ program }}" {% if program == request.GET.program %}selected{% endif %}>{{ program }}</option>
              {% endfor %}
            </select>
          </li>
          <li class="text-center">
            <button type="submit" class="btn btn-light btn-sm">Apply Filters</button>
          </li>
        </ul>
      </div>
    </form>
  </div>
</div>

<div class="title-container">
  <div class="circle"></div>
  <div class="circle right-circle"></div>
  <h2 class="batch-title">
    {% if request.GET.year %}
      BATCH {{ request.GET.year }}
    {% else %}
      BATCH {{  user_profile.batch_year }}
    {% endif %}
  </h2>
  <div class="circle"></div>
  <div class="circle right-circle"></div>
</div>

<!-- Profile List -->
<div class="profile-list d-flex flex-wrap justify-content-center gap-4 p-4">
  {% for profile in filtered_profiles %}
  <div class="profile-circle text-center">
    <a href="#" class="profile-link" 
      data-bs-toggle="modal" 
      data-bs-target="#profileModal"
      data-name="{{ profile.first_name }} {{ profile.last_name }}"
      data-image="{{ profile.profile_pic.url }}"
      data-quote="{{ profile.quote }}"
      data-hobbies="{{ profile.hobbies }}" 
      data-social="{{ profile.social_link }}"> 
   <img src="{{ profile.profile_pic.url }}" 
        alt="{{ profile.first_name }}'s profile picture" 
        class="profile-image" />
    </a>
    <div class="profile-circle-details">
        <p class="profile-name">{{ profile.first_name }} {{ profile.last_name }}</p>
        <p class="profile-quote">"{{ profile.quote }}"</p>
    </div>
  </div>
  {% empty %}
  <p>No profiles found for this batch.</p>
  {% endfor %}
</div>

<!-- Modal Structure -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="width: 600px;"> <!-- Fixed width for the modal -->
      <div class="modal-header">
        <h5 class="modal-title" id="profileModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex">
        <!-- Left Column -->
        <div class="left-column d-flex flex-column align-items-center" style="width: 50%;">
          <div class="d-flex justify-content-between w-100">
            <button id="prevProfileBtn" class="btn btn-prev"><</button>
            <img id="profileImage" class="img-fluid rounded-circle mb-3" style="width: 120px; height: 120px;" alt="Profile Image" />
            <button id="nextProfileBtn" class="btn btn-next">></button>
          </div>
        </div>
        <!-- Right Column -->
        <div class="right-column" style="width: 50%;">
          <p><strong>Quote:</strong> <span id="profileQuote"></span></p>
          <div id="profileDetails">
            <p><strong>Hobbies:</strong> <span id="profileHobbies"></span></p>
            <div class="social-links mt-3">
              <a id="socialLink" href="#" target="_blank" style="display: none;">
                <img src="{% static 'path/to/social-icon.png' %}" alt="Social Icon" style="width: 30px; height: 30px;" />
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



{% endblock %}
